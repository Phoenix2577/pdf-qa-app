<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">

  <meta charset="UTF-8">
  <title>PDF Q&A with OpenAI</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f7fb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px;
      margin: 0;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      width: 600px;
      max-width: 95%;
    }

    h2 {
      margin-top: 0;
      color: #333;
      text-align: center;
    }

    input[type="file"] {
      margin: 10px 0;
      padding: 8px;
    }

    textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 15px;
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
      transition: border-color 0.3s;
    }
    textarea:focus {
      border-color: #4a90e2;
      outline: none;
    }

    button {
      background: #4a90e2;
      color: white;
      padding: 12px 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      margin-top: 15px;
      transition: background 0.3s;
      display: block;
      width: 100%;
    }
    button:hover {
      background: #357ABD;
    }

    h3 {
      margin-top: 25px;
      color: #444;
    }

    #answer {
      white-space: pre-wrap;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 10px;
      margin-top: 10px;
      background: #fafafa;
      min-height: 50px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìÑ Ask Questions from PDF</h2>

    <!-- File upload -->
    <input type="file" id="fileInput" accept="application/pdf">

    <!-- Question input -->
    <textarea id="question" placeholder="Type your question here..."></textarea>

    <!-- Submit -->
    <button id="askBtn">Ask</button>

    <!-- Answer output -->
    <h3>Answer:</h3>
    <div id="answer"></div>
  </div>

  <script>
    let pdfText = ''; // store extracted PDF text

    // Extract text from PDF
    async function extractTextFromPDF(file) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      let text = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(item => item.str).join(' ') + '\n';
      }
      return text;
    }

    // Query OpenAI API (Chat Completions)
    async function queryOpenAI(question, context, key) {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${key}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [
            {
              role: "system",
              content: "You are a helpful assistant. Use the given PDF text to answer user questions precisely."
            },
            {
              role: "user",
              content: `Context:\n${context}\n\nQuestion: ${question}`
            }
          ],
          max_tokens: 500,
          temperature: 0
        })
      });

      if (!response.ok) {
        const err = await response.json();
        throw new Error(err.error?.message || "OpenAI API error");
      }

      const data = await response.json();
      return data.choices[0].message.content.trim();
    }

    // Handle PDF upload
    document.getElementById("fileInput").addEventListener("change", async (event) => {
      const file = event.target.files[0];
      if (file) {
        document.getElementById("answer").innerText = "üìö Processing PDF...";
        pdfText = await extractTextFromPDF(file);
        document.getElementById("answer").innerText = "‚úÖ PDF loaded. Now ask a question!";
      }
    });

    // Handle asking question
    document.getElementById("askBtn").addEventListener("click", async () => {
      const question = document.getElementById("question").value;
      if (!pdfText) {
        alert("Please upload a PDF first.");
        return;
      }
      if (!question.trim()) {
        alert("Please enter a question.");
        return;
      }

      document.getElementById("answer").innerText = "ü§î Thinking...";

      try {
        // üîë Replace with your real API key
        const apiKey = "YOUR_OPENAI_API_KEY";

        const answer = await queryOpenAI(question, pdfText, apiKey);
        document.getElementById("answer").innerText = answer;
      } catch (err) {
        document.getElementById("answer").innerText = "‚ùå Error: " + err.message;
      }
    });
  </script>
</body>
</html>
